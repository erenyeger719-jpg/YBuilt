@tailwind base;
@tailwind components;
@tailwind utilities;

/* --- Premium display fonts (wire-in, with fallbacks) --- */
@font-face {
  font-family: "Biospace";
  src: url("/fonts/Biospace.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: "Dirty Queen";
  src: url("/fonts/Dirty%20Queen.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* CSS Vars for consistent usage */
:root {
  --font-display: "Biospace", Cinzel, Marcellus, serif;
  --font-tagline: "Dirty Queen", "Cormorant Garamond", serif;
  --font-ui: ui-sans-serif, system-ui, -apple-system, "Inter", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
}

/* Global UI font (keeps everything else professional) */
body { font-family: var(--font-ui); }

/* Utilities for hero */
.h-display {
  font-family: var(--font-display);
  letter-spacing: .01em;
}
.h-tagline {
  font-family: var(--font-tagline);
  letter-spacing: .18em; /* elegant caps */
  text-transform: uppercase;
}

@media (prefers-reduced-motion: reduce) {
  :root {
    --shimmer-animation: none;
  }
}

@media (prefers-reduced-motion: no-preference) {
  :root {
    --shimmer-animation: shimmer 20s linear infinite;
  }
}

/* LIGHT MODE */
:root {
  --button-outline: rgba(0,0,0, .10);
  --badge-outline: rgba(0,0,0, .05);

  /* Automatic computation of border around primary / danger buttons */
  --opaque-button-border-intensity: -8; /* In terms of percentages */

  /* Backgrounds applied on top of other backgrounds when hovered/active */
  --elevate-1: rgba(0,0,0, .03);
  --elevate-2: rgba(0,0,0, .08);

  --background: 0 0% 100%;

  --foreground: 0 0% 0%;

  --border: 0 0% 85%;

  --card: 0 0% 98%;

  --card-foreground: 0 0% 5%;

  --card-border: 0 0% 88%;

  --sidebar: 0 0% 94%;

  --sidebar-foreground: 0 0% 12%;

  --sidebar-border: 0 0% 86%;

  --sidebar-primary: 0 0% 15%;

  --sidebar-primary-foreground: 0 0% 98%;

  --sidebar-accent: 0 0% 88%;

  --sidebar-accent-foreground: 0 0% 12%;

  --sidebar-ring: 0 0% 20%;

  --popover: 0 0% 92%;

  --popover-foreground: 0 0% 14%;

  --popover-border: 0 0% 84%;

  --primary: 0 0% 8%;

  --primary-foreground: 0 0% 98%;

  --secondary: 0 0% 90%;

  --secondary-foreground: 0 0% 10%;

  --muted: 0 0% 92%;

  --muted-foreground: 0 0% 40%;

  --accent: 0 0% 95%;

  --accent-foreground: 0 0% 10%;

  --destructive: 0 72% 32%;

  --destructive-foreground: 0 0% 98%;

  --input: 0 0% 70%;
  --ring: 0 0% 24%;
  --chart-1: 0 0% 22%;
  --chart-2: 0 0% 28%;
  --chart-3: 0 0% 34%;
  --chart-4: 0 0% 40%;
  --chart-5: 0 0% 46%;

  /* Use UI font for Tailwind's font-sans pipeline */
  --font-sans: var(--font-ui);
  --font-serif: Georgia, serif;
  --font-mono: Menlo, monospace;
  --radius: .5rem; /* 8px */
  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --tracking-normal: 0em;
  --spacing: 0.25rem;

  /* Glass and Gloss System */
  --glass-alpha: 0.12;
  --glass-reflection: rgba(255,255,255,0.08);
  --rim-strength: rgba(255,255,255,0.10);

  /* Workspace Prompt Bar Layout Variables */
  --prompt-bar-height: 180px;
  --file-chips-height: 32px;
  --prompt-actions-height: 48px;

  /* Modal z-index for consistent layering */
  --modal-z: 99999;

  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */

  /* Fallback for older browsers */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --sidebar-accent-border: hsl(var(--sidebar-accent));
  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

.dark {
  --button-outline: rgba(255,255,255, .10);
  --badge-outline: rgba(255,255,255, .05);

  --opaque-button-border-intensity: 9;  /* In terms of percentages */

  /* Backgrounds applied on top of other backgrounds when hovered/active */
  --elevate-1: rgba(255,255,255, .04);
  --elevate-2: rgba(255,255,255, .09);

  --background: 0 0% 0%;

  --foreground: 0 0% 100%;

  --border: 0 0% 20%;

  --card: 0 0% 5%;

  --card-foreground: 0 0% 95%;

  --card-border: 0 0% 15%;

  --sidebar: 0 0% 10%;

  --sidebar-foreground: 0 0% 88%;

  --sidebar-border: 0 0% 16%;

  --sidebar-primary: 0 0% 18%;

  --sidebar-primary-foreground: 0 0% 98%;

  --sidebar-accent: 0 0% 14%;

  --sidebar-accent-foreground: 0 0% 90%;

  --sidebar-ring: 0 0% 80%;

  --popover: 0 0% 12%;

  --popover-foreground: 0 0% 86%;

  --popover-border: 0 0% 20%;

  --primary: 0 0% 95%;

  --primary-foreground: 0 0% 5%;

  --secondary: 0 0% 12%;

  --secondary-foreground: 0 0% 92%;

  --muted: 0 0% 10%;

  --muted-foreground: 0 0% 60%;

  --accent: 0 0% 8%;

  --accent-foreground: 0 0% 90%;

  --destructive: 0 72% 32%;

  --destructive-foreground: 0 0% 98%;

  --input: 0 0% 30%;
  --ring: 0 0% 76%;
  --chart-1: 0 0% 78%;
  --chart-2: 0 0% 72%;
  --chart-3: 0 0% 66%;
  --chart-4: 0 0% 60%;
  --chart-5: 0 0% 54%;

  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);

  /* Glass and Gloss Material System */
  --glass-alpha: 0.12;
  --glass-reflection: rgba(255,255,255,0.08);
  --rim-strength: rgba(255,255,255,0.10);

  /* Automatically computed borders */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --sidebar-accent-border: hsl(var(--sidebar-accent));
  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

/* Library Page Forced Theme - Overrides global theme */
body[data-force-theme="library"] .library-root,
.library-theme {
  /* Force Library color scheme regardless of system theme */
  --lib-bg-right: #000000;
  --lib-bg-center: #E01010;
  --lib-bg-left-start: #CFF2FF;
  --lib-bg-left-end: #9BD6FF;
  --lib-glass-alpha: 0.14;
  --lib-rim: rgba(255,255,255,0.12);
  --lib-text-on-dark: #FFFFFF;
  --lib-text-on-light: #000000;
}

/* Library root background with diagonal glass stripes */
body[data-force-theme="library"] .library-root {
  --r: var(--lib-bg-right);
  --c: var(--lib-bg-center);
  --l1: var(--lib-bg-left-start);
  --l2: var(--lib-bg-left-end);
  background:
    linear-gradient(120deg,
      var(--r) 0% 33%,
      var(--c) 33% 66%,
      var(--l1) 66% 100%
    );
  background-size: cover;
  position: relative;
  overflow: hidden;
}

/* Glass overlay with matcap reflection */
body[data-force-theme="library"] .library-root::before {
  content: "";
  position: absolute;
  inset: 0;
  background: url('/library-glass-matcap.webp') center/cover no-repeat;
  opacity: 0.14;
  mix-blend-mode: overlay;
  pointer-events: none;
  backdrop-filter: blur(8px) saturate(120%);
}

/* Text backplate for contrast */
.lib-text-backplate {
  background: rgba(0,0,0,0.36);
  padding: 6px 10px;
  border-radius: 8px;
}

/* ========================================
   SETTINGS PAGE THEME (Black → Purple → Sky Blue)
   ======================================== */
body[data-force-theme="settings"] .settings-root,
.settings-theme {
  /* Force Settings color scheme */
  --settings-bg-right: #000000;
  --settings-bg-center: #7A1FF3;
  --settings-bg-left-start: #CFF2FF;
  --settings-bg-left-end: #9BD6FF;
  --settings-glass-alpha: 0.14;
  --settings-rim: rgba(255,255,255,0.12);
  --settings-text-on-dark: #FFFFFF;
  --settings-text-on-light: #000000;
}

/* Settings root background with soft diagonal gradient blend */
body[data-force-theme="settings"] .settings-root {
  --r: var(--settings-bg-right);
  --c: var(--settings-bg-center);
  --l1: var(--settings-bg-left-start);
  --l2: var(--settings-bg-left-end);
  background:
    linear-gradient(120deg in oklch,
      var(--r) 0% 40%,
      var(--c) 40% 70%,
      var(--l1) 70% 100%
    );
  background-size: cover;
  position: relative;
  overflow: hidden;
}

/* Glass overlay with matcap reflection */
body[data-force-theme="settings"] .settings-root::before {
  content: "";
  position: absolute;
  inset: 0;
  background: url('/settings-glass-matcap.webp') center/cover no-repeat;
  opacity: var(--settings-glass-alpha);
  mix-blend-mode: overlay;
  pointer-events: none;
  backdrop-filter: blur(10px) saturate(130%);
}

/* Settings text on dark backgrounds */
body[data-force-theme="settings"] .settings-text-light {
  color: var(--settings-text-on-dark);
}

/* Settings text on light backgrounds */
body[data-force-theme="settings"] .settings-text-dark {
  color: var(--settings-text-on-light);
}

/* ===== Studio — Heavenly Aurora (Obsidian Orchid) ===== */
body[data-force-theme="studio"] .studio-root {
  /* palette + knobs */
  --studio-right: #0A0A0B;
  --studio-center: #B22E7A;
  --studio-left: #E6EEF6; /* a touch softer than DDE7F2 */
  --studio-stop1: 38%;
  --studio-stop2: 70%;
  --studio-silk-op: 0.78; /* was 0.65 */

  /* tweakable paper intensity */
  --studio-paper-op: 0.14;

  /* pointer glow defaults */
  --mx: 50%;
  --my: 50%;
  --glow: radial-gradient(
    34rem 24rem at var(--mx) var(--my),   /* bigger */
    hsl(var(--accent) / .20),             /* stronger */
    transparent 60%
  );

  /* filmic scroll stops (driven by JS) */
  --scroll: 0;
  --stop1: calc(var(--studio-stop1) + 10% * var(--scroll));
  --stop2: calc(var(--studio-stop2) + 6%  * var(--scroll));

  position: relative;
  min-height: 100vh;
  isolation: isolate;

  /* BASE DIAGONAL BANDS (uses dynamic stops) */
  background:
    linear-gradient(
      135deg,
      var(--studio-right) 0% var(--stop1),
      var(--studio-center) var(--stop1) var(--stop2),
      var(--studio-left)   var(--stop2) 100%
    );
}

/* Tiny crumpled paper, only over orchid + white */
body[data-force-theme="studio"] .studio-root::before {
  content: "";
  position: fixed; inset: 0; z-index: 1; pointer-events: none;

  background-image: url("/library-glass-matcap.webp");
  background-position: center;
  background-repeat: repeat;
  background-size: 220px 220px;   /* small like Library */
  filter: saturate(0) contrast(1.05) brightness(1.03);
  mix-blend-mode: multiply;        /* keeps hues intact */
  opacity: var(--studio-paper-op); /* ~0.10–0.18 works well */

  /* mask out the black band (0 → stop1) */
  -webkit-mask-image: linear-gradient(
    135deg,
    transparent 0 var(--studio-stop1),
    #000 var(--studio-stop1) 100%
  );
  mask-image: linear-gradient(
    135deg,
    transparent 0 var(--studio-stop1),
    #000 var(--studio-stop1) 100%
  );
  mask-mode: luminance;
}

/* slow aurora + silk + micro paper noise + pointer glow */
@keyframes auroraShift {
  0%   { background-position: 0% 0%, 100% 0%, 0% 100%, 18% 24%, 82% 36%, 38% 78%; }
  50%  { background-position: 100% 50%, 0% 50%, 100% 0%, 18% 24%, 82% 36%, 38% 78%; }
  100% { background-position: 0% 0%, 100% 0%, 0% 100%, 18% 24%, 82% 36%, 38% 78%; }
}
body[data-force-theme="studio"] .studio-root::after {
  content: "";
  position: fixed; inset: 0; z-index: 2; pointer-events: none;

  background-image:
    var(--glow),                                /* pointer glow */
    /* AURORA (3 wide, soft passes) */
    radial-gradient(60% 40% at 20% 30%, rgba(226,121,180,.28), transparent 60%),
    radial-gradient(45% 35% at 80% 25%, rgba(255,149,210,.20), transparent 60%),
    radial-gradient(55% 45% at 40% 80%, rgba(180,210,255,.22), transparent 60%),
    /* SILK highlight */
    linear-gradient(120deg, rgba(255,255,255,.16), rgba(255,255,255,.02) 28% 72%, rgba(255,255,255,.10)),
    /* MICRO noise */
    radial-gradient(40% 40% at 18% 24%, rgba(0,0,0,.08), transparent 45%),
    radial-gradient(35% 35% at 82% 36%, rgba(255,255,255,.07), transparent 50%),
    radial-gradient(35% 35% at 38% 78%, rgba(0,0,0,.06), transparent 52%);

  background-repeat: no-repeat;
  background-size: 100% 100%;
  background-blend-mode:
    screen,                                     /* glow */
    screen, screen, screen,                     /* aurora passes */
    overlay, overlay, overlay, overlay;         /* silk + micro noise */
  mix-blend-mode: normal;

  animation: auroraShift 38s ease-in-out infinite;
  opacity: var(--studio-silk-op);
}

@media (prefers-reduced-motion: reduce) {
  body[data-force-theme="studio"] .studio-root::after { background-image: none; }
}

/* token nudges so UI matches the scene */
body[data-force-theme="studio"] {
  --primary: 329 36% 58%;
  --primary-foreground: 0 0% 100%;
  --accent: 329 64% 70%;
  --ring: 329 64% 70%;
}

/* richer glass for this palette (keep your existing .card-glass base) */
body[data-force-theme="studio"] .card-glass {
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
  border: 1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(12px) saturate(135%) contrast(1.02);
  -webkit-backdrop-filter: blur(12px) saturate(135%);
  box-shadow: 0 28px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05);
  border-radius: 16px;
}
body[data-force-theme="studio"] .card-glass .gloss-sheen::after {
  content: "";
  position: absolute; inset: 0; pointer-events: none;
  background: linear-gradient(120deg, rgba(255,255,255,.18), rgba(255,255,255,.04) 35%, transparent 60%);
  mix-blend-mode: screen;
  transform: translateY(-28%) rotate(-12deg);
  opacity: .9;
}

/* make cards glossy like Settings */
.card-glass {
  position: relative;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.18);
  backdrop-filter: blur(10px);
}

.gloss-sheen {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(120deg, rgba(255,255,255,0.18), transparent 30% 70%, rgba(255,255,255,0.08));
  opacity: 0.6;
  border-radius: inherit;
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply font-sans antialiased bg-background text-foreground;
  }
}

/**
 * Using the elevate system.
 */
@layer utilities {

  /* Hide ugly search cancel button in Chrome until we can style it properly */
  input[type="search"]::-webkit-search-cancel-button {
    @apply hidden;
  }

  /* Placeholder styling for contentEditable div */
  [contenteditable][data-placeholder]:empty::before {
    content: attr(data-placeholder);
    color: hsl(var(--muted-foreground));
    pointer-events: none;
  }

  .no-default-hover-elevate {}
  .no-default-active-elevate {}

  .toggle-elevate::before,
  .toggle-elevate-2::before {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    z-index: -1;
  }

  .toggle-elevate.toggle-elevated::before {
    background-color: var(--elevate-2);
  }

  .border.toggle-elevate::before {
    inset: -1px;
  }

  .hover-elevate:not(.no-default-hover-elevate),
  .active-elevate:not(.no-default-active-elevate),
  .hover-elevate-2:not(.no-default-hover-elevate),
  .active-elevate-2:not(.no-default-active-elevate) {
    position: relative;
    z-index: 0;
  }

  .hover-elevate:not(.no-default-hover-elevate)::after,
  .active-elevate:not(.no-default-active-elevate)::after,
  .hover-elevate-2:not(.no-default-hover-elevate)::after,
  .active-elevate-2:not(.no-default-active-elevate)::after {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    z-index: 999;
  }

  .hover-elevate:hover:not(.no-default-hover-elevate)::after,
  .active-elevate:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-1);
  }

  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,
  .active-elevate-2:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-2);
  }

  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,
  .border.active-elevate:not(.no-active-interaction-elevate)::after,
  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,
  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,
  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {
    inset: -1px;
  }

  /* Glass and Gloss Material System */
  .card-glass {
    background: linear-gradient(180deg, rgba(255,255,255,var(--glass-alpha)), rgba(255,255,255,0.02));
    border: 1px solid var(--rim-strength);
    backdrop-filter: blur(10px) saturate(140%);
    box-shadow: 0 18px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 14px;
    position: relative;
    overflow: hidden;
  }

  .gloss-sheen::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(120deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02) 30%, transparent 60%);
    mix-blend-mode: screen;
    transform: translateY(-30%) rotate(-12deg);
    opacity: 0.9;
  }

  .metal-text {
    background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(220,220,220,0.65));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 1px 0 rgba(0,0,0,0.8), 0 10px 30px rgba(0,0,0,0.55);
  }

  .dark .metal-text {
    background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(220,220,220,0.65));
  }

  /* Diagonal Glass Stripe System */
  .glass-stripe-container {
    position: absolute;
    inset: -20%;
    overflow: hidden;
    transform: rotate(-30deg);
  }

  .glass-stripe {
    position: absolute;
    top: -50%;
    bottom: -50%;
    width: 8%;
    transition: transform 0.3s ease;
  }

  .glass-stripe-white {
    background: linear-gradient(
      90deg,
      rgba(255, 255, 255, 0.15) 0%,
      rgba(255, 255, 255, 0.25) 50%,
      rgba(255, 255, 255, 0.15) 100%
    );
    border-left: 1px solid rgba(255, 255, 255, 0.3);
    border-right: 1px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(8px) saturate(150%) contrast(1.2);
    -webkit-backdrop-filter: blur(8px) saturate(150%) contrast(1.2);
    box-shadow:
      inset 0 0 20px rgba(255, 255, 255, 0.1),
      0 0 30px rgba(255, 255, 255, 0.05);
  }

  .glass-stripe-black {
    background: linear-gradient(
      90deg,
      rgba(0, 0, 0, 0.4) 0%,
      rgba(0, 0, 0, 0.6) 50%,
      rgba(0, 0, 0, 0.4) 100%
    );
    border-left: 1px solid rgba(0, 0, 0, 0.5);
    border-right: 1px solid rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px) saturate(120%) contrast(1.1);
    -webkit-backdrop-filter: blur(8px) saturate(120%) contrast(1.1);
    box-shadow:
      inset 0 0 20px rgba(0, 0, 0, 0.2),
      0 0 30px rgba(0, 0, 0, 0.15);
  }

  /* Parallax hover effect */
  .glass-stripe-container:hover .glass-stripe {
    transform: translateX(2px);
  }

  /* Reflected headline text */
  .hero-reflection {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(2.4rem, 5vw, 4rem);
    font-weight: bold;
    text-align: center;
    color: rgba(255, 255, 255, 0.12);
    transform: scaleY(-1) translateY(30%) rotate(30deg);
    filter: blur(2px);
    mix-blend-mode: screen;
    pointer-events: none;
    letter-spacing: -0.02em;
  }

  .dark .hero-reflection {
    color: rgba(255, 255, 255, 0.08);
  }

  /* Shimmer particles along glass edges */
  @keyframes shimmer {
    0%, 100% { opacity: 0; transform: translateY(0); }
    50% { opacity: 1; transform: translateY(-10px); }
  }

  .glass-stripe-white::before,
  .glass-stripe-black::before {
    content: '';
    position: absolute;
    top: 20%;
    right: -1px;
    width: 2px;
    height: 3px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    animation: shimmer 3s ease-in-out infinite;
  }

  .glass-stripe-white::after,
  .glass-stripe-black::after {
    content: '';
    position: absolute;
    bottom: 30%;
    left: -1px;
    width: 2px;
    height: 3px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 50%;
    animation: shimmer 4s ease-in-out infinite;
    animation-delay: 1s;
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .glass-stripe-container:hover .glass-stripe {
      transform: none;
    }

    .glass-stripe-white::before,
    .glass-stripe-black::before,
    .glass-stripe-white::after,
    .glass-stripe-black::after {
      animation: none;
      opacity: 0.3;
    }
  }

  /* Logo dropdown — premium glass style (workspace only) */
  .logo-menu.workspace {
    min-width: 260px !important;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)) !important;
    border: 1px solid rgba(255,255,255,0.06) !important;
    backdrop-filter: blur(10px) saturate(120%) !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.6) !important;
    border-radius: 12px !important;
    padding: 8px !important;
    color: var(--text-main, #eaeaea) !important;
    font-family: var(--font-display, 'Valmeria','Inter','Poppins',system-ui,sans-serif) !important;
    z-index: 9999 !important;
  }

  /* menu items: modern spacing */
  .logo-menu.workspace [role="menuitem"] {
    display: flex;
    align-items: center;
    justify-content: space-between; /* text left, icon right */
    gap: 12px;
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: background .12s ease, transform .06s ease;
  }

  /* hover/focus states */
  .logo-menu.workspace [role="menuitem"]:hover,
  .logo-menu.workspace [role="menuitem"]:focus {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    transform: translateY(-1px);
    outline: none;
  }

  /* right-aligned icon: keep "six spaces" effect via margin-left */
  .logo-menu.workspace .menu-label {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
  }

  .logo-menu.workspace .menu-icon {
    margin-left: 24px; /* ~6 spaces visual gap */
    flex: 0 0 auto;
    width: 20px;
    height: 20px;
    opacity: .95;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.45));
  }

  /* Dark mode adjustments for workspace menu */
  .dark .logo-menu.workspace {
    background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)) !important;
    border: 1px solid rgba(255,255,255,0.08) !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.8) !important;
  }

  .dark .logo-menu.workspace [role="menuitem"]:hover,
  .dark .logo-menu.workspace [role="menuitem"]:focus {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)) !important;
  }

  /* Help submenu high z-index to prevent cropping */
  .help-side-popup {
    position: fixed !important;
    z-index: var(--modal-z) !important;
  }
}

/* --- chat FAB safety pins (prevent rogue globals from flipping sides) --- */
[data-testid="button-chat-dock"],
[data-testid="button-chat-workspace"] {
  position: fixed !important;
  left: auto !important;
  top: auto !important;
  right: 1rem !important;
  bottom: 1rem !important;
}
@media (min-width: 768px) {
  [data-testid="button-chat-dock"],
  [data-testid="button-chat-workspace"] {
    right: 1.5rem !important;
    bottom: 1.5rem !important;
  }
}

/* === Additional interaction utilities === */
@layer utilities {
  /* Magnetic button */
  .btn-magnetic {
    --tx: 0px; --ty: 0px;
    transform: translate3d(var(--tx), var(--ty), 0) scale(1);
    transition: transform .12s ease, box-shadow .14s ease;
    will-change: transform;
  }
  .btn-magnetic:hover { transform: translate3d(var(--tx), var(--ty), 0) scale(1.02); }

  /* Tilted glass card */
  .card-tilt {
    transform: perspective(900px) rotateX(var(--rx,0deg)) rotateY(var(--ry,0deg));
    transition: transform .15s ease, box-shadow .2s ease;
    will-change: transform;
  }
  /* (optional depth polish) */
  .card-tilt { box-shadow: 0 28px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06); }

  /* Diagonal text reveal */
  .reveal-diag {
    --clip: polygon(0 0, 0 0, 0 100%, 0 100%);
    clip-path: var(--clip);
    transition: clip-path .7s cubic-bezier(.2,.8,.2,1);
    will-change: clip-path;
  }
  .reveal-diag.in {
    --clip: polygon(0 0, 100% 0, 100% 100%, 0 100%);
  }

  /* Perf helper for heavy blocks */
  .content-auto { content-visibility: auto; contain-intrinsic-size: 800px 1000px; }
}

/* =========================
   WORKSPACE ONLY: purple press state
   ========================= */
body[data-page="workspace"] .workspace-root {
  --press-purple: #7A1FF3;
  --press-ink: #fff;
  --press-border: color-mix(in oklch, #7A1FF3 88%, black);
  --press-glow: 0 10px 32px #7A1FF333;
}

body[data-page="workspace"] .workspace-root :is(button, .btn, [role="button"]) {
  transition: background-color .14s ease, border-color .14s ease,
              color .14s ease, box-shadow .14s ease, transform .06s ease;
}

/* only buttons; no generic [data-state="open"] */
body[data-page="workspace"] .workspace-root
:is(button, .btn, [role="button"]):active,
body[data-page="workspace"] .workspace-root
:is(button[aria-pressed="true"], .btn[aria-pressed="true"], [role="button"][aria-pressed="true"]),
body[data-page="workspace"] .workspace-root
:is(button[data-state="on"], .btn[data-state="on"], [role="button"][data-state="on"]) {
  background-color: var(--press-purple) !important;
  border-color: var(--press-border) !important;
  color: var(--press-ink) !important;
  box-shadow: var(--press-glow) !important;
}

body[data-page="workspace"] .workspace-root
:is(button, .btn, [role="button"]):focus-visible {
  outline: 2px solid color-mix(in oklch, #7A1FF3 86%, white 14%);
  outline-offset: 2px;
}

body[data-page="workspace"] .workspace-root
:is(button, .btn, [role="button"]):hover {
  box-shadow: 0 6px 24px #7A1FF326;
}

/* ===== View Transitions (global) ===== */
/* Soft flash from orchid → white */
::view-transition-old(root) { animation: fadeOut .28s ease both; }
::view-transition-new(root) { animation: fadeIn  .28s ease .06s both; }
@keyframes fadeOut { to { opacity: .6; filter: saturate(.92) blur(.3px); } }
@keyframes fadeIn  { from { opacity: 0; filter: saturate(1.05) blur(2px); } }

@media (prefers-reduced-motion: reduce) {
  ::view-transition-old(root), ::view-transition-new(root) { animation: none; }
}
