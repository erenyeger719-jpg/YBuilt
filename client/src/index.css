@tailwind base;
@tailwind components;
@tailwind utilities;

/* --- Premium display fonts (wire-in, with fallbacks) --- */
@font-face {
  font-family: "Biospace";
  src: url("/fonts/Biospace.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: "Dirty Queen";
  src: url("/fonts/Dirty%20Queen.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* CSS Vars for consistent usage */
:root {
  --font-display: "Biospace", Cinzel, Marcellus, serif;
  --font-tagline: "Dirty Queen", "Cormorant Garamond", serif;
  --font-ui: ui-sans-serif, system-ui, -apple-system, "Inter", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
}

/* Global UI font (keeps everything else professional) */
body { font-family: var(--font-ui); }

/* Utilities for hero */
.h-display {
  font-family: var(--font-display);
  letter-spacing: .01em;
}
.h-tagline {
  font-family: var(--font-tagline);
  letter-spacing: .18em; /* elegant caps */
  text-transform: uppercase;
}

@media (prefers-reduced-motion: reduce) {
  :root {
    --shimmer-animation: none;
  }
}

@media (prefers-reduced-motion: no-preference) {
  :root {
    --shimmer-animation: shimmer 20s linear infinite;
  }
}

/* LIGHT MODE */
:root {
  --button-outline: rgba(0,0,0, .10);
  --badge-outline: rgba(0,0,0, .05);

  /* Automatic computation of border around primary / danger buttons */
  --opaque-button-border-intensity: -8; /* In terms of percentages */

  /* Backgrounds applied on top of other backgrounds when hovered/active */
  --elevate-1: rgba(0,0,0, .03);
  --elevate-2: rgba(0,0,0, .08);

  --background: 0 0% 100%;

  --foreground: 0 0% 0%;

  --border: 0 0% 85%;

  --card: 0 0% 98%;

  --card-foreground: 0 0% 5%;

  --card-border: 0 0% 88%;

  --sidebar: 0 0% 94%;

  --sidebar-foreground: 0 0% 12%;

  --sidebar-border: 0 0% 86%;

  --sidebar-primary: 0 0% 15%;

  --sidebar-primary-foreground: 0 0% 98%;

  --sidebar-accent: 0 0% 88%;

  --sidebar-accent-foreground: 0 0% 12%;

  --sidebar-ring: 0 0% 20%;

  --popover: 0 0% 92%;

  --popover-foreground: 0 0% 14%;

  --popover-border: 0 0% 84%;

  --primary: 0 0% 8%;

  --primary-foreground: 0 0% 98%;

  --secondary: 0 0% 90%;

  --secondary-foreground: 0 0% 10%;

  --muted: 0 0% 92%;

  --muted-foreground: 0 0% 40%;

  --accent: 0 0% 95%;

  --accent-foreground: 0 0% 10%;

  --destructive: 0 72% 32%;

  --destructive-foreground: 0 0% 98%;

  --input: 0 0% 70%;
  --ring: 0 0% 24%;
  --chart-1: 0 0% 22%;
  --chart-2: 0 0% 28%;
  --chart-3: 0 0% 34%;
  --chart-4: 0 0% 40%;
  --chart-5: 0 0% 46%;

  /* Use UI font for Tailwind's font-sans pipeline */
  --font-sans: var(--font-ui);
  --font-serif: Georgia, serif;
  --font-mono: Menlo, monospace;
  --radius: .5rem; /* 8px */
  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --tracking-normal: 0em;
  --spacing: 0.25rem;

  /* Glass and Gloss System */
  --glass-alpha: 0.12;
  --glass-reflection: rgba(255,255,255,0.08);
  --rim-strength: rgba(255,255,255,0.10);

  /* Workspace Prompt Bar Layout Variables */
  --prompt-bar-height: 180px;
  --file-chips-height: 32px;
  --prompt-actions-height: 48px;

  /* Modal z-index for consistent layering */
  --modal-z: 99999;

  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */

  /* Fallback for older browsers */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --sidebar-accent-border: hsl(var(--sidebar-accent));
  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

.dark {
  --button-outline: rgba(255,255,255, .10);
  --badge-outline: rgba(255,255,255, .05);

  --opaque-button-border-intensity: 9;  /* In terms of percentages */

  /* Backgrounds applied on top of other backgrounds when hovered/active */
  --elevate-1: rgba(255,255,255, .04);
  --elevate-2: rgba(255,255,255, .09);

  --background: 0 0% 0%;

  --foreground: 0 0% 100%;

  --border: 0 0% 20%;

  --card: 0 0% 5%;

  --card-foreground: 0 0% 95%;

  --card-border: 0 0% 15%;

  --sidebar: 0 0% 10%;

  --sidebar-foreground: 0 0% 88%;

  --sidebar-border: 0 0% 16%;

  --sidebar-primary: 0 0% 18%;

  --sidebar-primary-foreground: 0 0% 98%;

  --sidebar-accent: 0 0% 14%;

  --sidebar-accent-foreground: 0 0% 90%;

  --sidebar-ring: 0 0% 80%;

  --popover: 0 0% 12%;

  --popover-foreground: 0 0% 86%;

  --popover-border: 0 0% 20%;

  --primary: 0 0% 95%;

  --primary-foreground: 0 0% 5%;

  --secondary: 0 0% 12%;

  --secondary-foreground: 0 0% 92%;

  --muted: 0 0% 10%;

  --muted-foreground: 0 0% 60%;

  --accent: 0 0% 8%;

  --accent-foreground: 0 0% 90%;

  --destructive: 0 72% 32%;

  --destructive-foreground: 0 0% 98%;

  --input: 0 0% 30%;
  --ring: 0 0% 76%;
  --chart-1: 0 0% 78%;
  --chart-2: 0 0% 72%;
  --chart-3: 0 0% 66%;
  --chart-4: 0 0% 60%;
  --chart-5: 0 0% 54%;

  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);

  /* Glass and Gloss Material System */
  --glass-alpha: 0.12;
  --glass-reflection: rgba(255,255,255,0.08);
  --rim-strength: rgba(255,255,255,0.10);

  /* Automatically computed borders */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --sidebar-accent-border: hsl(var(--accent));
  --sidebar-accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

/* Library Page Forced Theme - Overrides global theme */
body[data-force-theme="library"] .library-root,
.library-theme {
  /* Force Library color scheme regardless of system theme */
  --lib-bg-right: #000000;
  --lib-bg-center: #E01010;
  --lib-bg-left-start: #CFF2FF;
  --lib-bg-left-end: #9BD6FF;
  --lib-glass-alpha: 0.14;
  --lib-rim: rgba(255,255,255,0.12);
  --lib-text-on-dark: #FFFFFF;
  --lib-text-on-light: #000000;
}

/* Library root background with diagonal glass stripes */
body[data-force-theme="library"] .library-root {
  --r: var(--lib-bg-right);
  --c: var(--lib-bg-center);
  --l1: var(--lib-bg-left-start);
  --l2: var(--lib-bg-left-end);
  background:
    linear-gradient(120deg,
      var(--r) 0% 33%,
      var(--c) 33% 66%,
      var(--l1) 66% 100%
    );
  background-size: cover;
  position: relative;
  overflow: hidden;
}

/* Glass overlay with matcap reflection */
body[data-force-theme="library"] .library-root::before {
  content: "";
  position: absolute;
  inset: 0;
  background: url('/library-glass-matcap.webp') center/cover no-repeat;
  opacity: 0.14;
  mix-blend-mode: overlay;
  pointer-events: none;
  backdrop-filter: blur(8px) saturate(120%);
}

/* Text backplate for contrast */
.lib-text-backplate {
  background: rgba(0,0,0,0.36);
  padding: 6px 10px;
  border-radius: 8px;
}

/* ========================================
   SETTINGS PAGE THEME (Black → Purple → Sky Blue)
   ======================================== */
body[data-force-theme="settings"] .settings-root,
.settings-theme {
  /* Force Settings color scheme */
  --settings-bg-right: #000000;
  --settings-bg-center: #7A1FF3;
  --settings-bg-left-start: #CFF2FF;
  --settings-bg-left-end: #9BD6FF;
  --settings-glass-alpha: 0.14;
  --settings-rim: rgba(255,255,255,0.12);
  --settings-text-on-dark: #FFFFFF;
  --settings-text-on-light: #000000;
}

/* Settings root background with soft diagonal gradient blend */
body[data-force-theme="settings"] .settings-root {
  --r: var(--settings-bg-right);
  --c: var(--settings-bg-center);
  --l1: var(--settings-bg-left-start);
  --l2: var(--settings-bg-left-end);
  background:
    linear-gradient(120deg in oklch,
      var(--r) 0% 40%,
      var(--c) 40% 70%,
      var(--l1) 70% 100%
    );
  background-size: cover;
  position: relative;
  overflow: hidden;
}

/* Glass overlay with matcap reflection */
body[data-force-theme="settings"] .settings-root::before {
  content: "";
  position: absolute;
  inset: 0;
  background: url('/settings-glass-matcap.webp') center/cover no-repeat;
  opacity: var(--settings-glass-alpha);
  mix-blend-mode: overlay;
  pointer-events: none;
  backdrop-filter: blur(10px) saturate(130%);
}

/* Settings text on dark backgrounds */
body[data-force-theme="settings"] .settings-text-light {
  color: var(--settings-text-on-dark);
}

/* Settings text on light backgrounds */
body[data-force-theme="settings"] .settings-text-dark {
  color: var(--settings-text-on-light);
}

/* ===== Studio — Heavenly Aurora (Obsidian Orchid) ===== */
body[data-force-theme="studio"] .studio-root {
  /* palette + knobs */
  --studio-right: #0A0A0B;
  --studio-center: #B22E7A;
  --studio-left: #E6EEF6; /* a touch softer than DDE7F2 */
  --studio-stop1: 38%;
  --studio-stop2: 70%;
  --studio-silk-op: 0.78; /* was 0.65 */

  /* tweakable paper intensity */
  --studio-paper-op: 0.14;

  /* pointer glow defaults */
  --mx: 50%;
  --my: 50%;
  --glow: radial-gradient(
    34rem 24rem at var(--mx) var(--my),   /* bigger */
    hsl(var(--accent) / .20),             /* stronger */
    transparent 60%
  );

  /* filmic scroll stops (driven by JS) */
  --scroll: 0;
  --stop1: calc(var(--studio-stop1) + 10% * var(--scroll));
  --stop2: calc(var(--studio-stop2) + 6%  * var(--scroll));

  position: relative;
  min-height: 100vh;
  isolation: isolate;

  /* BASE DIAGONAL BANDS (uses dynamic stops) */
  background:
    linear-gradient(
      135deg,
      var(--studio-right) 0% var(--stop1),
      var(--studio-center) var(--stop1) var(--stop2),
      var(--studio-left)   var(--stop2) 100%
    );
}

/* Tiny crumpled paper, only over orchid + white */
body[data-force-theme="studio"] .studio-root::before {
  content: "";
  position: fixed; inset: 0; z-index: 1; pointer-events: none;

  background-image: url("/library-glass-matcap.webp");
  background-position: center;
  background-repeat: repeat;
  background-size: 220px 220px;   /* small like Library */
  filter: saturate(0) contrast(1.05) brightness(1.03);
  mix-blend-mode: multiply;        /* keeps hues intact */
  opacity: var(--studio-paper-op); /* ~0.10–0.18 works well */

  /* mask out the black band (0 → stop1) */
  -webkit-mask-image: linear-gradient(
    135deg,
    transparent 0 var(--studio-stop1),
    #000 var(--studio-stop1) 100%
  );
  mask-image: linear-gradient(
    135deg,
    transparent 0 var(--studio-stop1),
    #000 var(--studio-stop1) 100%
  );
  mask-mode: luminance;
}

/* slow aurora + silk + micro paper noise + pointer glow */
@keyframes auroraShift {
  0%   { background-position: 0% 0%, 100% 0%, 0% 100%, 18% 24%, 82% 36%, 38% 78%; }
  50%  { background-position: 100% 50%, 0% 50%, 100% 0%, 18% 24%, 82% 36%, 38% 78%; }
  100% { background-position: 0% 0%, 100% 0%, 0% 100%, 18% 24%, 82% 36%, 38% 78%; }
}
body[data-force-theme="studio"] .studio-root::after {
  content: "";
  position: fixed; inset: 0; z-index: 2; pointer-events: none;

  background-image:
    var(--glow),                                /* pointer glow */
    /* AURORA (3 wide, soft passes) */
    radial-gradient(60% 40% at 20% 30%, rgba(226,121,180,.28), transparent 60%),
    radial-gradient(45% 35% at 80% 25%, rgba(255,149,210,.20), transparent 60%),
    radial-gradient(55% 45% at 40% 80%, rgba(180,210,255,.22), transparent 60%),
    /* SILK highlight */
    linear-gradient(120deg, rgba(255,255,255,.16), rgba(255,255,255,.02) 28% 72%, rgba(255,255,255,.10)),
    /* MICRO noise */
    radial-gradient(40% 40% at 18% 24%, rgba(0,0,0,.08), transparent 45%),
    radial-gradient(35% 35% at 82% 36%, rgba(255,255,255,.07), transparent 50%),
    radial-gradient(35% 35% at 38% 78%, rgba(0,0,0,.06), transparent 52%);

  background-repeat: no-repeat;
  background-size: 100% 100%;
  background-blend-mode:
    screen,                                     /* glow */
    screen, screen, screen,                     /* aurora passes */
    overlay, overlay, overlay, overlay;         /* silk + micro noise */
  mix-blend-mode: normal;

  animation: auroraShift 38s ease-in-out infinite;
  opacity: var(--studio-silk-op);
}

@media (prefers-reduced-motion: reduce) {
  body[data-force-theme="studio"] .studio-root::after { background-image: none; }
}

/* token nudges so UI matches the scene */
body[data-force-theme="studio"] {
  --primary: 329 36% 58%;
  --primary-foreground: 0 0% 100%;
  --accent: 329 64% 70%;
  --ring: 329 64% 70%;
}

/* richer glass for this palette (keep your existing .card-glass base) */
body[data-force-theme="studio"] .card-glass {
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
  border: 1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(12px) saturate(135%) contrast(1.02);
  -webkit-backdrop-filter: blur(12px) saturate(135%);
  box-shadow: 0 28px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05);
  border-radius: 16px;
}
body[data-force-theme="studio"] .card-glass .gloss-sheen::after {
  content: "";
  position: absolute; inset: 0; pointer-events: none;
  background: linear-gradient(120deg, rgba(255,255,255,.18), rgba(255,255,255,.04) 35%, transparent 60%);
  mix-blend-mode: screen;
  transform: translateY(-28%) rotate(-12deg);
  opacity: .9;
}

/* make cards glossy like Settings */
.card-glass {
  position: relative;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.18);
  backdrop-filter: blur(10px);
}

.gloss-sheen {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(120deg, rgba(255,255,255,0.18), transparent 30% 70%, rgba(255,255,255,0.08));
  opacity: 0.6;
  border-radius: inherit;
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply font-sans antialiased bg-background text-foreground;
  }
}

/**
 * Using the elevate system.
 */
@layer utilities {

  /* Hide ugly search cancel button in Chrome until we can style it properly */
  input[type="search"]::-webkit-search-cancel-button {
    @apply hidden;
  }

  /* Placeholder styling for contentEditable div */
  [contenteditable][data-placeholder]:empty::before {
    content: attr(data-placeholder);
    color: hsl(var(--muted-foreground));
    pointer-events: none;
  }

  .no-default-hover-elevate {}
  .no-default-active-elevate {}

  .toggle-elevate::before,
  .toggle-elevate-2::before {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    z-index: -1;
  }

  .toggle-elevate.toggle-elevated::before {
    background-color: var(--elevate-2);
  }

  .border.toggle-elevate::before {
    inset: -1px;
  }

  .hover-elevate:not(.no-default-hover-elevate),
  .active-elevate:not(.no-default-active-elevate),
  .hover-elevate-2:not(.no-default-hover-elevate),
  .active-elevate-2:not(.no-default-active-elevate) {
    position: relative;
    z-index: 0;
  }

  .hover-elevate:not(.no-default-hover-elevate)::after,
  .active-elevate:not(.no-default-active-elevate)::after,
  .hover-elevate-2:not(.no-default-hover-elevate)::after,
  .active-elevate-2:not(.no-default-active-elevate)::after {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    z-index: 999;
  }

  .hover-elevate:hover:not(.no-default-hover-elevate)::after,
  .active-elevate:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-1);
  }

  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,
  .active-elevate-2:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-2);
  }

  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,
  .border.active-elevate:not(.no-active-interaction-elevate)::after,
  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,
  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,
  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {
    inset: -1px;
  }

  /* Glass and Gloss Material System */
  .card-glass {
    background: linear-gradient(180deg, rgba(255,255,255,var(--glass-alpha)), rgba(255,255,255,0.02));
    border: 1px solid var(--rim-strength);
    backdrop-filter: blur(10px) saturate(140%);
    box-shadow: 0 18px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 14px;
    position: relative;
    overflow: hidden;
  }

  .gloss-sheen::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(120deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02) 30%, transparent 60%);
    mix-blend-mode: screen;
    transform: translateY(-30%) rotate(-12deg);
    opacity: 0.9;
  }

  .metal-text {
    background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(220,220,220,0.65));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 1px 0 rgba(0,0,0,0.8), 0 10px 30px rgba(0,0,0,0.55);
  }

  .dark .metal-text {
    background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(220,220,220,0.65));
  }

  /* Diagonal Glass Stripe System */
  .glass-stripe-container {
    position: absolute;
    inset: -20%;
    overflow: hidden;
    transform: rotate(-30deg);
  }

  .glass-stripe {
    position: absolute;
    top: -50%;
    bottom: -50%;
    width: 8%;
    transition: transform 0.3s ease;
  }

  .glass-stripe-white {
    background: linear-gradient(
      90deg,
      rgba(255, 255, 255, 0.15) 0%,
      rgba(255, 255, 255, 0.25) 50%,
      rgba(255, 255, 255, 0.15) 100%
    );
    border-left: 1px solid rgba(255, 255, 255, 0.3);
    border-right: 1px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(8px) saturate(150%) contrast(1.2);
    -webkit-backdrop-filter: blur(8px) saturate(150%) contrast(1.2);
    box-shadow:
      inset 0 0 20px rgba(255, 255, 255, 0.1),
      0 0 30px rgba(255, 255, 255, 0.05);
  }

  .glass-stripe-black {
    background: linear-gradient(
      90deg,
      rgba(0, 0, 0, 0.4) 0%,
      rgba(0, 0, 0, 0.6) 50%,
      rgba(0, 0, 0, 0.4) 100%
    );
    border-left: 1px solid rgba(0, 0, 0, 0.5);
    border-right: 1px solid rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px) saturate(120%) contrast(1.1);
    -webkit-backdrop-filter: blur(8px) saturate(120%) contrast(1.1);
    box-shadow:
      inset 0 0 20px rgba(0, 0, 0, 0.2),
      0 0 30px rgba(0, 0, 0, 0.15);
  }

  /* Parallax hover effect */
  .glass-stripe-container:hover .glass-stripe {
    transform: translateX(2px);
  }

  /* Reflected headline text */
  .hero-reflection {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(2.4rem, 5vw, 4rem);
    font-weight: bold;
    text-align: center;
    color: rgba(255, 255, 255, 0.12);
    transform: scaleY(-1) translateY(30%) rotate(30deg);
    filter: blur(2px);
    mix-blend-mode: screen;
    pointer-events: none;
    letter-spacing: -0.02em;
  }

  .dark .hero-reflection {
    color: rgba(255, 255, 255, 0.08);
  }

  /* Shimmer particles along glass edges */
  @keyframes shimmer {
    0%, 100% { opacity: 0; transform: translateY(0); }
    50% { opacity: 1; transform: translateY(-10px); }
  }

  .glass-stripe-white::before,
  .glass-stripe-black::before {
    content: '';
    position: absolute;
    top: 20%;
    right: -1px;
    width: 2px;
    height: 3px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    animation: shimmer 3s ease-in-out infinite;
  }

  .glass-stripe-white::after,
  .glass-stripe-black::after {
    content: '';
    position: absolute;
    bottom: 30%;
    left: -1px;
    width: 2px;
    height: 3px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 50%;
    animation: shimmer 4s ease-in-out infinite;
    animation-delay: 1s;
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .glass-stripe-container:hover .glass-stripe {
      transform: none;
    }

    .glass-stripe-white::before,
    .glass-stripe-black::before,
    .glass-stripe-white::after,
    .glass-stripe-black::after {
      animation: none;
      opacity: 0.3;
    }
  }

  /* Logo dropdown — premium glass style (workspace only) */
  .logo-menu.workspace {
    min-width: 260px !important;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)) !important;
    border: 1px solid rgba(255,255,255,0.06) !important;
    backdrop-filter: blur(10px) saturate(120%) !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.6) !important;
    border-radius: 12px !important;
    padding: 8px !important;
    color: var(--text-main, #eaeaea) !important;
    font-family: var(--font-display, 'Valmeria','Inter','Poppins',system-ui,sans-serif) !important;
    z-index: 9999 !important;
  }

  /* menu items: modern spacing */
  .logo-menu.workspace [role="menuitem"] {
    display: flex;
    align-items: center;
    justify-content: space-between; /* text left, icon right */
    gap: 12px;
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: background .12s ease, transform .06s ease;
  }

  /* hover/focus states */
  .logo-menu.workspace [role="menuitem"]:hover,
  .logo-menu.workspace [role="menuitem"]:focus {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    transform: translateY(-1px);
    outline: none;
  }

  /* right-aligned icon: keep "six spaces" effect via margin-left */
  .logo-menu.workspace .menu-label {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
  }

  .logo-menu.workspace .menu-icon {
    margin-left: 24px; /* ~6 spaces visual gap */
    flex: 0 0 auto;
    width: 20px;
    height: 20px;
    opacity: .95;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.45));
  }

  /* Dark mode adjustments for workspace menu */
  .dark .logo-menu.workspace {
    background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)) !important;
    border: 1px solid rgba(255,255,255,0.08) !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.8) !important;
  }

  .dark .logo-menu.workspace [role="menuitem"]:hover,
  .dark .logo-menu.workspace [role="menuitem"]:focus {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)) !important;
  }

  /* Help submenu high z-index to prevent cropping */
  .help-side-popup {
    position: fixed !important;
    z-index: var(--modal-z) !important;
  }
}

/* --- chat FAB safety pins (prevent rogue globals from flipping sides) --- */
[data-testid="button-chat-dock"],
[data-testid="button-chat-workspace"] {
  position: fixed !important;
  left: auto !important;
  top: auto !important;
  right: 1rem !important;
  bottom: 1rem !important;
}
@media (min-width: 768px) {
  [data-testid="button-chat-dock"],
  [data-testid="button-chat-workspace"] {
    right: 1.5rem !important;
    bottom: 1.5rem !important;
  }
}

/* ===== View Transitions (global) ===== */
/* Soft flash from orchid → white */
::view-transition-old(root) { animation: fadeOut .28s ease both; }
::view-transition-new(root) { animation: fadeIn  .28s ease .06s both; }
@keyframes fadeOut { to { opacity: .6; filter: saturate(.92) blur(.3px); } }
@keyframes fadeIn  { from { opacity: 0; filter: saturate(1.05) blur(2px); } }

@media (prefers-reduced-motion: reduce) {
  ::view-transition-old(root), ::view-transition-new(root) { animation: none; }
}

/* --- Weavy section + grid band ---------------------------------------- */
/* Clean white weavy zone, no rounded "card", with a full-width grid band */
.weavy-section {
  --gap: 16px; /* “one space” for the band grid */
  position: relative;
  background: #fff;
  padding-bottom: 6rem;
  overflow-x: hidden; /* nudge: prevent horizontal scroll */
}

/* Optional canvas wrapper for board */
.weavy-canvas { position: relative; }

/* Full-width grid band; set top/height inline in the component */
.grid-band {
  position: absolute; left: 0; right: 0;
  z-index: 0; pointer-events: none;
  /* where the grid starts fading (percentage of its own height) */
  --grid-fade-start: 70%;
  --grid-line: rgba(0,0,0,.35); /* strong enough to read on white */
  background:
    /* white “paper” base so the grid shows on white */
    linear-gradient(180deg, #fff, #fff),
    radial-gradient(900px 420px at 50% -20%, rgba(0,0,0,.06), transparent 60%),
    /* black grid lines */
    repeating-linear-gradient(0deg,  var(--grid-line) 0 1px, transparent 1px calc(var(--gap) + 1px)),
    repeating-linear-gradient(90deg, var(--grid-line) 0 1px, transparent 1px calc(var(--gap) + 1px));
  -webkit-mask-image: linear-gradient(180deg, #000 var(--grid-fade-start), transparent 100%);
  mask-image: linear-gradient(180deg, #000 var(--grid-fade-start), transparent 100%);
}

/* Pixel spill layer (sits over the grid band, under content) */
.pixel-spill {
  position: absolute;
  left: 0; right: 0;
  z-index: 1;
  pointer-events: none;
}

/* Legacy sparse grid islands (kept for reuse; currently unused) */
.grid-island {
  position: absolute;
  background:
    radial-gradient(800px 400px at 30% -20%, rgba(11,18,25,0.06), transparent 60%),
    repeating-linear-gradient(0deg, rgba(2,6,23,0.08) 0 1px, transparent 1px 24px),
    repeating-linear-gradient(90deg, rgba(2,6,23,0.08) 0 1px, transparent 1px 24px);
  border-radius: 16px;
  mask-image: radial-gradient(150% 120% at 50% 50%, #000 30%, transparent 95%);
  -webkit-mask-image: radial-gradient(150% 120% at 50% 50%, #000 30%, transparent 95%);
  filter: saturate(1.05);
}
/* .grid-island { display: none; } */

/* --- Weavy node styling ------------------------------------------------ */
/* Minimal pill nodes; remove glass card look (will be overridden by panel glass below) */
.node-card {
  position: absolute;
  border-radius: 999px; /* pill */
  background: transparent;
  border: none;
  cursor: grab;
  user-select: none;
}
.node-card:active { cursor: grabbing; }

.node-title {
  font-size: 10px;
  letter-spacing: .22em;
  text-transform: uppercase;
  color: #6B7280;
  padding: 10px 12px 4px;
}

/* Keep the inner “one-space” grid for media slots */
.slot-media {
  --cell: 16px;
  margin: 8px 12px 12px;
  height: calc(100% - 40px);
  border-radius: 12px;
  border: 1px dashed rgba(0,0,0,.18);
  background:
    linear-gradient(180deg, rgba(241,245,249,.65), rgba(248,250,252,.4)),
    repeating-linear-gradient(0deg, rgba(2,6,23,.06) 0 1px, transparent 1px calc(var(--cell) + 1px)),
    repeating-linear-gradient(90deg, rgba(2,6,23,.05) 0 1px, transparent 1px calc(var(--cell) + 1px));
  display: grid; place-items: center;
}
.slot-media .placeholder {
  font-size: 12px; color: #64748B; opacity: .9;
}

/* Tiny anchor nubs */
.nub { position: absolute; width: 10px; height: 10px; background: #E5E7EB; border: 1px solid #CBD5E1; border-radius: 999px; }
.nub-l { left: -5px; top: 50%; transform: translateY(-50%); }
.nub-r { right: -5px; top: 50%; transform: translateY(-50%); }
.nub-t { top: -5px; left: 50%; transform: translateX(-50%); }
.nub-b { bottom: -5px; left: 50%; transform: translateX(-50%); }

/* ---------------- Tiny CSS additions (thread styling) ------------------ */
/* Weavy thread wires */
.wire-thread path {
  stroke: #CBD5E1;              /* slate-300 */
  stroke-width: 2.25;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
  filter: url(#threadShadow);
}

.wire-dot {
  fill: #FFFFFF;
  stroke: #CBD5E1;
  stroke-width: 1;
}

.wire-bead {
  fill: #E5E7EB;                /* slate-200 */
  stroke: #D1D5DB;
  stroke-width: .5;
}

/* Node label (small, quiet) */
.node-label {
  font-size: 10px;
  letter-spacing: .22em;
  text-transform: uppercase;
  color: #6B7280;               /* slate-500 */
  padding: 8px 10px 4px;
}

/* Node container: clean panel glass (overrides the pill above) */
.node-card {
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.55));
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: 0 18px 40px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.35);
  backdrop-filter: blur(6px) saturate(120%);
  cursor: grab;
  user-select: none;
}
.node-card:active { cursor: grabbing; }

/* media placeholder (tightened spacing + one-space grid) */
.slot-media {
  margin: 6px 10px 10px;
  height: calc(100% - 28px);
  border-radius: 12px;
  border: 1px dashed rgba(0,0,0,.18);
  background:
    linear-gradient(180deg, rgba(241,245,249,.65), rgba(248,250,252,.4)),
    repeating-linear-gradient(0deg, rgba(2,6,23,.06) 0 1px, transparent 1px 17px),
    repeating-linear-gradient(90deg, rgba(2,6,23,.05) 0 1px, transparent 1px 17px);
  display: grid; place-items: center;
}
.slot-media .placeholder { font-size: 12px; color: #64748B; opacity: .9; }

/* Nubs (kept) */
.nub { position: absolute; width: 10px; height: 10px; background: #E5E7EB; border: 1px solid #CBD5E1; border-radius: 999px; }
.nub-l { left: -5px; top: 50%; transform: translateY(-50%); }
.nub-r { right: -5px; top: 50%; transform: translateY(-50%); }
.nub-t { top: -5px; left: 50%; transform: translateX(-50%); }
.nub-b { bottom: -5px; left: 50%; transform: translateX(-50%); }

/* ---------------- dd/adjust styles (threads, grid band, node polish) --- */
/* Denser grid spacing; keep the black-line background from the base .grid-band */
.weavy-section .grid-band { --gap: 14px; }

/* ===== Safety nudges (prevent horizontal scroll) ===== */
.weavy-section { overflow-x: hidden; }
.weavy-canvas { position: relative; }
.grid-band { left: 0; right: 0; }

/* ===== Nocturne Eden — dark neutrals + natural accent ===== */
.nocturne-band {
  position: relative;
  isolation: isolate;
  /* keep the hero vibe (graphite ribbon), not pure black */
  background:
    radial-gradient(1400px 420px at 50% -160px, oklch(0.92 0 0 / .06), transparent 60%),
    linear-gradient(180deg, oklch(0.15 0 0) 0%, oklch(0.12 0 0) 60%, oklch(0.13 0 0) 100%);
  color: white;

  /* tokens inside this band (buttons/focus use these) */
  --primary: 140 26% 54%;        /* moss */
  --accent: 230 28% 62%;         /* sky */
  --ring:   230 28% 62%;
}

/* slow “natural” aurora—moss, peach-sand, sky */
.nocturne-band::before {
  content: "";
  position: absolute; inset: -10% -6% -16%;
  background:
    radial-gradient(60% 38% at 16% 12%,  oklch(0.80 .09 230 / .22), transparent 60%),
    radial-gradient(55% 35% at 86% 26%,  oklch(0.84 .10 70  / .18), transparent 60%),
    radial-gradient(70% 48% at 48% 110%, oklch(0.75 .09 140 / .20), transparent 60%);
  mix-blend-mode: screen;
  animation: edenPan 52s ease-in-out infinite;
  pointer-events: none;
}

/* subtle inner vignette so cards pop */
.nocturne-band::after {
  content: "";
  position: absolute; inset: 0;
  background:
    radial-gradient(1200px 260px at 50% -120px, rgba(255,255,255,.14), transparent 60%),
    radial-gradient(1200px 320px at 50% 105%, rgba(0,0,0,.35), transparent 55%);
  pointer-events: none;
  opacity: .65;
}

@keyframes edenPan {
  0%   { background-position:   0%  0%, 100%  0%,   0% 100%; }
  50%  { background-position: 100% 50%,   0% 50%, 100%   0%; }
  100% { background-position:   0%  0%, 100%  0%,   0% 100%; }
}

/* ===== Cinematic Prism — graphite base + moving spectral flare ===== */
.prism-band {
  position: relative;
  isolation: isolate;
  color: white;

  /* graphite → matches hero */
  background:
    radial-gradient(1400px 420px at 50% -160px, oklch(0.92 0 0 / .07), transparent 60%),
    linear-gradient(180deg, oklch(0.15 0 0) 0%, oklch(0.12 0 0) 62%, oklch(0.13 0 0) 100%);

  /* UI token accents inside the band */
  --accent: 330 0.45 0.70;   /* punchy orchid (magenta) */
  --accent-2: 230 0.28 0.67; /* sky/cyan */
  --accent-3: 70  0.20 0.78; /* amber/peach */
  --ring: var(--accent);
  --primary: 150 0.20 0.62;  /* emerald lift */
}

/* moving prism sweep (magenta ↔ cyan ↔ amber) */
.prism-band::before {
  content: "";
  position: absolute; inset: -12% -6% -16%;
  background:
    /* wide aurora plates */
    radial-gradient(60% 42% at 18% 18%, oklch(0.78 .21 330 / .25), transparent 60%), /* magenta */
    radial-gradient(52% 36% at 82% 24%, oklch(0.82 .18 230 / .22), transparent 60%), /* cyan   */
    radial-gradient(70% 56% at 48% 108%, oklch(0.86 .16 70 / .18),  transparent 60%);/* amber  */
  mix-blend-mode: screen;
  animation: prismSweep 42s ease-in-out infinite;
  pointer-events: none;
}

/* fine vignette + micrograin for “cinema” depth */
.prism-band::after {
  content: "";
  position: absolute; inset: 0;
  background:
    radial-gradient(1200px 280px at 50% -120px, rgba(255,255,255,.15), transparent 62%),
    radial-gradient(1200px 340px at 50% 106%, rgba(0,0,0,.40), transparent 55%),
    /* ultra-light film grain (cheap, CSS-only) */
    repeating-linear-gradient(0deg, rgba(255,255,255,.018) 0 1px, transparent 1px 2px),
    repeating-linear-gradient(90deg, rgba(0,0,0,.018) 0 1px, transparent 1px 2px);
  background-blend-mode: normal, normal, overlay, overlay;
  opacity: .70;
  pointer-events: none;
}

@keyframes prismSweep {
  0%   { transform: translate3d(0,0,0);   filter: saturate(110%); }
  50%  { transform: translate3d(-4%,2%,0); filter: saturate(120%); }
  100% { transform: translate3d(0,0,0);   filter: saturate(110%); }
}

/* Prefer-reduced-motion respect */
@media (prefers-reduced-motion: reduce) {
  .prism-band::before { animation: none; }
}

/* ===== Atelier Paper (Riso) — cut-paper, no gradients ===== */
.atelier-band {
  position: relative;
  isolation: isolate;
  color: white;

  /* graphite base to match hero */
  background: #0d0f13;
  /* micro paper grain — very light, not a gradient feel */
  background-image:
    repeating-linear-gradient(0deg, rgba(255,255,255,.015) 0 1px, transparent 1px 2px),
    repeating-linear-gradient(90deg, rgba(0,0,0,.02) 0 1px, transparent 1px 2px);
}

/* ink palette (high-contrast, proven risograph hues) */
.atelier-band {
  --ink-ivory:  #f6f2e8; /* paper */
  --ink-carbon: #0d0f13; /* base */
  --ink-cobalt: #3760ff; /* electric blue */
  --ink-verm:   #ff4d2e; /* vermilion */
  --ink-fuch:   #ff47a3; /* fuchsia */
  --ink-citron: #b7f35b; /* citron / natural pop */
  --ink-ink:    #0b0c10; /* strokes */

  --ring: 330 0.65 0.72;      /* for focus rings / UI */
  --accent: 330 0.48 0.72;    /* headlines */
  --accent-2: 230 0.30 0.67;  /* cool secondary */
}

/* flat “paper blocks” (cut shapes). Each block is a positioned element. */
.paper-block {
  position: absolute;
  pointer-events: none;
  filter: drop-shadow(0 20px 50px rgba(0,0,0,.45));
  /* deckled paper edge */
  background-image:
    repeating-linear-gradient(0deg, rgba(0,0,0,.03) 0 2px, transparent 2px 4px),
    repeating-linear-gradient(90deg, rgba(255,255,255,.02) 0 2px, transparent 2px 4px);
}

/* colors */
.paper-cobalt  { background-color: var(--ink-cobalt); }
.paper-verm    { background-color: var(--ink-verm); }
.paper-fuch    { background-color: var(--ink-fuch); }
.paper-citron  { background-color: var(--ink-citron); }
.paper-ivory   { background-color: var(--ink-ivory); }

/* torn / cut edges via clip-path polygons (feel free to tweak points) */
.block-torn-1 { clip-path: polygon(0% 8%, 92% 0%, 100% 70%, 8% 100%); }
.block-torn-2 { clip-path: polygon(6% 0%, 100% 12%, 94% 100%, 0% 86%); }
.block-torn-3 { clip-path: polygon(0% 0%, 100% 6%, 94% 94%, 8% 100%); }

/* subtle “pen hatch” layer for art vibe (apply to elements needing texture) */
.sketch-hatch {
  background-image:
    repeating-linear-gradient(45deg, rgba(0,0,0,.06) 0 1px, transparent 1px 6px),
    repeating-linear-gradient(-45deg, rgba(255,255,255,.03) 0 1px, transparent 1px 7px);
  background-blend-mode: multiply;
}

/* sketchy outline for cards (keeps your glass but adds hand-drawn feel) */
.sketch-edge {
  position: relative;
}
.sketch-edge::after {
  content: "";
  position: absolute; inset: -2px;
  border: 2px solid rgba(255,255,255,.55);
  border-radius: inherit;
  /* jittered outline illusion */
  clip-path: polygon(
    0% 3%, 10% 0%, 20% 1%, 30% 0%, 40% 2%, 50% 0%,
    60% 2%, 70% 0%, 80% 1%, 90% 0%, 100% 3%,
    100% 97%, 90% 100%, 80% 99%, 70% 100%, 60% 98%,
    50% 100%, 40% 98%, 30% 100%, 20% 99%, 10% 100%, 0% 97%
  );
  opacity: .28;
  pointer-events: none;
}

/* risograph “registration offset” for headings (no extra markup) */
.riso-register {
  text-shadow:
    2px 1px 0 var(--ink-fuch),
   -2px -1px 0 var(--ink-cobalt);
  letter-spacing: .01em;
}

/* focus rings on glass in this band */
.atelier-band .card-glass:focus-within {
  box-shadow: 0 0 0 2px hsl(var(--ring) / .45), 0 24px 60px rgba(0,0,0,.55);
}
